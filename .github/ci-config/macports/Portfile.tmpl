# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0
PortGroup           github 1.0

github.setup        kubetail-org kubetail ${VERSION} cli/v
revision            0

master_sites        https://github.com/${github.author}/${github.project}/releases/download/${github.tag_prefix}${github.version}/

distname            kubetail-cli.orig
worksrcdir          kubetail-cli

use_xz              yes

supported_archs     arm64 x86_64

categories          devel
license             Apache-2
maintainers         {kubetail.com:andres @amorey} openmaintainer

description         Real-time logging tool for Kubernetes
long_description    Kubetail is a general-purpose logging tool for Kubernetes, optimized \
                    for tailing logs across multi-container workloads in real-time. With \
                    Kubetail, you can view logs from all the containers in a workload \
                    merged into a single, chronological timeline, in a browser or a \
                    terminal.

checksums           ${distname}${extract.suffix} \
                    rmd160  ${RMD160} \
                    sha256  ${SHA256} \
                    size    ${SIZE}

use_configure       no

depends_build-append port:go

build {
    system -W ${worksrcpath}/modules/cli "GOWORK=off CGO_ENABLED=0 ${prefix}/bin/go build -mod=vendor -ldflags '-s -w -X github.com/kubetail-org/kubetail/modules/cli/cmd.version=${version}' -o ../../bin/kubetail ."
}

destroot {
    xinstall -m 0755 ${worksrcpath}/bin/kubetail ${destroot}${prefix}/bin/kubetail

    xinstall -d ${destroot}${prefix}/share/doc/${name}
    if {[file exists ${worksrcpath}/LICENSE]} {
        xinstall -m 0644 ${worksrcpath}/LICENSE ${destroot}${prefix}/share/doc/${name}/
    }
}
